<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Brass Band Library — Search</title>
  <style>
    :root {
      --bg:#0b0c0f;--card:#11131a;--muted:#8891a7;--fg:#e6e9f2;--pill:#1b2333;
      --accent:#4da3ff;--accent-2:#ffb547;
    }
    body.light {
      --bg:#f8f9fa;--card:#ffffff;--muted:#555;--fg:#111;
      --pill:#e5e5e5;--accent:#0056b3;--accent-2:#d97706;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial,sans-serif;transition:background .3s,color .3s}
    header{position:sticky;top:0;z-index:5;background:linear-gradient(180deg,var(--bg) 0%, rgba(11,12,15,.92) 90%, rgba(11,12,15,0) 100%);backdrop-filter:blur(6px);padding:12px 16px;border-bottom:1px solid #1a1f2b}
    body.light header{background:linear-gradient(180deg,var(--bg) 0%, rgba(248,249,250,.92) 90%, rgba(248,249,250,0) 100%);border-bottom:1px solid #ccc}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    input[type="text"], select{background:var(--card);border:1px solid #273047;color:var(--fg);padding:10px 12px;border-radius:10px;min-width:220px}
    body.light input[type="text"],body.light select{border:1px solid #ccc}
    input[type="checkbox"]{transform:translateY(1px)}
    .btn{background:#162037;border:1px solid #2a3350;color:var(--fg);padding:10px 14px;border-radius:10px;cursor:pointer}
    body.light .btn{background:#e5e5e5;border:1px solid #ccc;color:#111}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn.primary{background:linear-gradient(180deg,#1f4b7a,#133458);border-color:#27507f}
    body.light .btn.primary{background:linear-gradient(180deg,#5aa0e6,#2d7dd2);border-color:#1f5c99;color:#fff}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:var(--pill);border:1px solid #2a3350;color:var(--fg);font-size:13px;cursor:pointer;user-select:none}
    body.light .pill{border:1px solid #ccc}
    .pill.active{background:#1e2a44;border-color:#3a69ad;box-shadow:0 0 0 1px #2f5b97 inset}
    body.light .pill.active{background:#cde1f9;border-color:#5aa0e6;box-shadow:0 0 0 1px #5aa0e6 inset}
    .pill .x{opacity:.7;font-size:16px;line-height:1}
    .muted{color:var(--muted)}
    .wrap{max-width:1200px;margin:0 auto;padding:8px 16px 48px}
    .meta{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:8px 0}
    .grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:12px;margin-top:12px}
    @media(min-width:720px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:1100px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .card{background:var(--card);border:1px solid #1a2031;border-radius:16px;padding:14px;transition:background .3s,color .3s}
    body.light .card{border:1px solid #ddd}
    .title{font-weight:700;font-size:18px}
    .subtitle{font-weight:500;opacity:.9}
    .kv{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .kv span{font-size:12px;border:1px dashed #2a3350;border-radius:6px;padding:4px 6px;color:#cdd6f4}
    body.light .kv span{border:1px dashed #aaa;color:#333}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .right{margin-left:auto}
    .count{font-variant-numeric:tabular-nums}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .section{margin-top:12px}
    .small{font-size:12px}
    .footer{display:flex;justify-content:center;margin-top:16px}
    .pager{display:flex;gap:6px}
    .pager .btn{padding:8px 10px}
    .note{background:#0e1424;border:1px solid #243050;border-radius:12px;padding:10px}
    body.light .note{background:#f1f3f5;border:1px solid #ccc}
    .tag{border:1px solid #334; border-radius:6px;padding:2px 6px;margin-left:6px;color:#abc;font-size:11px}
    body.light .tag{color:#333;border-color:#aaa}
  </style>
</head>
<body>
  <header>
    <div class="row wrap" style="padding:0">
      <div class="row" style="flex:1 1 auto">
        <strong>Brass Band Library</strong>
        <span class="muted">· searchable catalogue</span>
      </div>
      <div class="row">
        <button id="themeBtn" class="btn" title="Toggle light/dark">Toggle Theme</button>
        <button id="refreshBtn" class="btn" title="Re-fetch the sheet">Refresh</button>
        <button id="copyLinkBtn" class="btn" title="Copy link with current filters">Copy link</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="row">
      <input id="q" type="text" placeholder="Search title / composer / anything…" />
      <select id="fieldScope" title="Fields to search">
        <option value="auto" selected>Search: Auto (smart)</option>
        <option value="all">Search: All fields</option>
        <option value="core">Search: Core fields only</option>
      </select>
      <label class="muted small"><input id="regexToggle" type="checkbox"/> RegEx</label>
      <label class="muted small"><input id="exactToggle" type="checkbox"/> Exact match</label>
      <span class="right muted small">Source: Google Sheet CSV</span>
    </div>

    <div class="section">
      <div class="muted small">Filter by pill (click to toggle). We auto-build useful sets (Composer, Arranger, Category/Type if present).</div>
      <div id="pills" class="chips" style="margin-top:8px"></div>
    </div>

    <div class="section">
      <div class="toolbar">
        <div class="muted count" id="counts">0 results</div>
        <div class="right row">
          <label class="muted small">Per page
            <select id="pageSize">
              <option>24</option>
              <option>48</option>
              <option selected>96</option>
              <option>200</option>
            </select>
          </label>
          <select id="sortBy">
            <option value="title">Sort: Title</option>
            <option value="composer">Sort: Composer</option>
            <option value="year">Sort: Year</option>
            <option value="none">Sort: None (sheet order)</option>
          </select>
        </div>
      </div>
      <div id="activeFilters" class="meta"></div>
      <div id="grid" class="grid"></div>
      <div class="footer">
        <div class="pager">
          <button id="prevBtn" class="btn">◀ Prev</button>
          <div class="muted small" id="pageInfo">Page 1</div>
          <button id="nextBtn" class="btn">Next ▶</button>
        </div>
      </div>
    </div>

    <details class="section">
      <summary class="muted">Diagnostics</summary>
      <div class="note small" id="diag">—</div>
    </details>
  </div>

<script>
const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTlXzPuOBpOlp9y9bj3wU0y4s7TUsrIWqehQ0MoVWfROYTSxbS6xF8kqpDuRq-rfmDV4ATtpLoTgd28/pub?gid=0&single=true&output=csv';

// ===== Utilities =====
const $ = sel => document.querySelector(sel);

// ===== Theme Toggle =====
(function(){
  const themeBtn = document.getElementById('themeBtn');
  let isLight = false;
  themeBtn.addEventListener('click', ()=>{
    document.body.classList.toggle('light');
    isLight = document.body.classList.contains('light');
    themeBtn.textContent = isLight? 'Dark Mode' : 'Light Mode';
  });
})();
</script>
</body>
</html>
